import{b as w,d as R,f as J,e as E,c as k}from"../chunks/C2en_OgJ.js";import{L as G,G as C,v as M,I as H,V as j,w as $,o as D,y as I,p as K,t as P,n as N,F as W,a as B,K as z,J as A,h as _,W as L,$ as F,M as Q,N as U,X as q,O as V}from"../chunks/BxmAoEMY.js";import{s as X,f as S}from"../chunks/BDr5ug_O.js";import{b as Y}from"../chunks/CsEGGwVD.js";function Z(O,b,g=!1,l=!1,T=!1){var y=O,p="";G(()=>{var i=H;if(p===(p=b()??"")){C&&M();return}if(i.nodes_start!==null&&(j(i.nodes_start,i.nodes_end),i.nodes_start=i.nodes_end=null),p!==""){if(C){$.data;for(var a=M(),d=a;a!==null&&(a.nodeType!==8||a.data!=="");)d=a,a=D(a);if(a===null)throw I(),K;w($,d),y=P(a);return}var u=p+"";g?u=`<svg>${u}</svg>`:l&&(u=`<math>${u}</math>`);var c=R(u);if((g||l)&&(c=N(c)),w(N(c),c.lastChild),g||l)for(;N(c);)y.before(N(c));else y.before(c)}})}const ee=!0,re=Object.freeze(Object.defineProperty({__proto__:null,prerender:ee},Symbol.toStringTag,{value:"Module"}));var te=J('<div style="display: none"><!></div> <!>',1);function le(O,b){W(b,!0);let g=L("<div id='test'>Just some text</div>"),l=L(void 0);const T=e=>{console.log("got message in html1",e),e.data==="parent ready"?(console.log("Sending to parent 2"),window.parent.postMessage("To parent","*")):e.data&&(console.log("event.data",e.data),e.data.startsWith("JSON:")?(console.log(`HTML Component received a message: ${e.data}`),S.form=JSON.parse(e.data.substring(5))):(console.log("HTML Message"),q(g,e.data,!0)))},y=e=>{console.log("htmlLoaded",e)},p=(e,r)=>{for(const t of e){const[s,o]=(()=>{const v=t.querySelector(".city-text"),m=t.querySelector(".city-small");if(v)return[v.textContent,m==null?void 0:m.textContent];const f=t.textContent.match(/^([^:：]+)(?:(?::|：)([,\d]+円))?$/);return f!=null&&f.length?[f[1],f[2]]:[t.textContent,void 0]})(),n=t.getElementsByTagName("img"),h=n.length===1?n[0].src:void 0;r.push({label:s,value:t.value,price:o,image:h})}},i=(e,r)=>{let t;for(const s of e.children)switch(s.tagName){case"SELECT":const o=s.previousElementSibling,n=s.nextElementSibling;let h;const v=s.getElementsByTagName("optgroup");if(v.length){h=[];for(const m of v){const f=[];h.push({options:f,name:m.label});const x=m.getElementsByTagName("option");p(x,f)}}else{const m=s.getElementsByTagName("option");h=[],p(m,h)}t={name:(o==null?void 0:o.textContent)??"No name",type:"select",label:(o==null?void 0:o.textContent)??"No label",options:h,info:(n==null?void 0:n.tagName)==="P"?n.textContent:void 0},r.questions.push(t);break;default:i(s,r);break}};B(()=>{var o;if(_(l)==null)return;console.log("mbhtml reset",(o=_(g))==null?void 0:o[0]),console.log(_(l).childNodes);const e=_(l).getElementsByTagName("form").item(0);if(e==null)return;const r={action:"",sections:[]};let t;const s=e.getElementsByTagName("section");if(s.length)for(const n of s)t={questions:[]},r.sections.push(t),i(n,t);else t={questions:[]},r.sections.push(t),i(e,t);console.log("setting fmdata"),S.form=r,console.log("fmdata has been set")}),B(()=>{const e=Reflect.ownKeys(S.options).reduce((r,t)=>{var o;const s=(o=S.options[String(t)])==null?void 0:o.price;if(s){const n=s.replace(/,/g,"").match(/(\d+)円/);n!=null&&n.length&&(r+=Number(n[1]))}return r},0);window.parent.postMessage(`priceUpdated: ${e}`,"*"),console.log(`Sent price update: ${e}`)});var a=te();E("message",F,T);var d=z(a),u=Q(d);Z(u,()=>_(g)),U(d),Y(d,e=>q(l,e),()=>_(l));var c=V(d,2);X(c,()=>b.children),E("load",d,y),k(O,a),A()}export{le as component,re as universal};
